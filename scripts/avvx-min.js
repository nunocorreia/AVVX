var TextInfo=function(b){this.title=b;this.info=document.getElementById("textInfo");this.info.children[0].innerHTML=this.title;var a=this;this.init=function(e,d,c,f){if(!f){f=a.title}a.info.children[0].innerHTML=f+" "+e;a.info.children[1].innerHTML="shuffle: "+d;a.info.children[2].innerHTML="mic: ";a.info.children[3].innerHTML="back:";a.info.children[4].innerHTML="";a.info.children[5].innerHTML="";a.info.children[6].innerHTML="";a.info.children[7].innerHTML="";a.info.children[8].innerHTML=""};this.setCredits=function(d,c){a.visualCredits=d;a.soundCredits=c;if(d){a.info.children[0].innerHTML+="<br/>"+d}if(c){a.info.children[2].innerHTML+="<br/>"+c}};this.changeTextA=function(e,d,c){a.info.children[1].innerHTML="shuffle: "+e;a.info.children[2].innerHTML="mic: "+d;a.info.children[3].innerHTML="back:"+c;if(a.soundCredits){a.info.children[2].innerHTML+="<br/>"+a.soundCredits}};this.changeTextB=function(d){for(var c=0;c<d.length;c++){a.info.children[c+4].innerHTML=d[c]}};this.changeTextC=function(d){for(var c=0;c<d.length;c++){a.info.children[c+4].innerHTML=d[c]}}};var Group=function(f,d){this.images=[];this.background=null;var j=this;var b=f.getAttribute("id");this.author=f.getAttribute("author");var a=f.getAttribute("url");j.background=f.getAttribute("bgimage");var h=[];for(var e=0;e<f.childNodes.length;e++){var c=f.childNodes[e];if(c.nodeType==1){var k=c.textContent;h.push(k)}}var g=h.length;h.forEach(function(l){var m=new XMLHttpRequest();m.onload=function(){var n=m.responseXML;j.images.push(n);if(--g<=0){d(j)}};m.open("get","images/"+l,true);m.send(null)})};var TouchUI=function(){var h=function(m){var k=m.target;var j=window.innerHeight-k.offsetHeight;var n=k.y+m.gesture.deltaY;if(n<0){n=0}else{if(n>j){n=j}}if(n!=k.offsetTop){k.style.top=n;var l=100-Math.round(100*n/j);avvx.onTouch({type:"slider",id:k.id,value:l})}if(m.type=="dragend"){k.y=k.offsetTop}};var g=function(k){var l={};if(k.type=="tap"){var j=k.gesture.center.pageX;var m=k.gesture.center.pageY;l.code=0;if(j>0&&j<window.innerWidth*(1/7)&&m>0&&m<40){l.code=32}if(j>window.innerWidth*(6/7)&&j<window.innerWidth&&m>0&&m<40){l.code=13}if(j>0&&j<window.innerWidth*(1/7)&&m>window.innerHeight-40&&m<window.innerHeight){l.code=17}if(j>window.innerWidth*(6/7)&&j<window.innerWidth&&m>window.innerHeight-40&&m<window.innerHeight){l.code=16}}else{if(k.type=="swipe"){l.dir=k.gesture.direction;l.count=k.gesture.touches.length}else{if(k.type=="transform"){l.x=k.gesture.center.pageX;l.y=k.gesture.center.pageY;l.dx=k.gesture.deltaX;l.dy=k.gesture.deltaY;l.angle=k.gesture.angle;l.vx=k.gesture.velocityX;l.vy=k.gesture.velocityY;l.scale=k.gesture.scale;l.rotation=k.gesture.rotation}}}l.type=k.type;avvx.onTouch(l)};var a=document.body;var c=Hammer(a,{hold:false,swipe_max_touches:2,swipe_velocity:0.7});c.on("tap swipe",g);var e=document.querySelectorAll(".slider");for(var d=0;d<e.length;d++){var f=e[d];f.style.left=window.innerWidth/7+f.offsetWidth*d+"px";f.y=f.offsetTop;var b=Hammer(f,{hold:false,drag_min_distance:5,drag_max_touches:0});b.on("drag dragend",h)}document.addEventListener("touchmove",function(j){j.preventDefault()},false)};var AudioEngine=function(){var m=2048;var a,g;var j,b,h;var l,d;var f=false;var k=false;this.init=function(n){j=new webkitAudioContext();b=j.createAnalyser();h=j.createScriptProcessor(m,1,1);h.onaudioprocess=c;l=document.querySelector("audio");b.fftSize=m;b.maxDecibels=0;if(n){l.src="sounds/"+n;d=j.createMediaElementSource(l);d.connect(b);b.connect(h);h.connect(j.destination);d.connect(j.destination)}};this.play=function(n){f=n;if(n){l.play()}else{l.pause()}};this.activate=function(o,n){k=n;if(o=="mic"){if(n){navigator.webkitGetUserMedia({audio:true},function(p){a=p;g=j.createMediaStreamSource(p);analyserNodeMic=j.createAnalyser();analyserNodeMic.fftSize=m;analyserNodeMic.maxDecibels=0;scriptNodeMic=j.createScriptProcessor(m,1,1);scriptNodeMic.onaudioprocess=e;analyserNodeMic.connect(scriptNodeMic);scriptNodeMic.connect(j.destination);g.connect(j.destination);g.connect(analyserNodeMic)},function(p){console.log("getUserMedia errorCode: "+p.code)})}else{if(a){g.disconnect();a.stop();a=null}}}};function c(){if(!f){return}var n=new Uint8Array(b.frequencyBinCount);b.getByteFrequencyData(n);var r=0;var q=n.length;for(var o=0;o<q;o++){r+=n[o]}var p=r/q;avvx.onAudio(p*0.01)}function e(){if(!k){return}var n=new Uint8Array(analyserNodeMic.frequencyBinCount);analyserNodeMic.getByteFrequencyData(n);var r=0;var q=n.length;for(var o=0;o<q;o++){r+=n[o]}var p=r/q;avvx.onAudio(p*0.01)}};var SketchLoader=function(k,c){this.sketches=[];var j=this;var h=k.getAttribute("key");var d=k.getAttribute("author");var a=k.getAttribute("url");var l=[];for(var e=0;e<k.childNodes.length;e++){var b=k.childNodes[e];if(b.nodeType==1){var g=b.textContent;l.push(g)}}var f=l.length;l.forEach(function(m){var n=new XMLHttpRequest();n.onload=function(){var o=n.responseText;j.sketches.push(o);if(--f<=0){c(j.sketches)}};n.open("get","sketches/"+m,true);n.send(null)})};var AVVX=function(){var a={Q:0,W:1,E:2,R:3,T:4,Y:5,U:6,I:7,O:8,P:9};var j={A:0,S:1,D:2,F:3,G:4};var m=[0,0,0,0];var h=[];var u=[];var q=[];var p;var x;var f;var n=this;var e={8:"obsolete",13:"sound",16:"background",17:"shuffle",32:"textinfo",77:"mic"};var o=imageGroup2=0;var l=-1;var d=false;var v;var r=false;var w=true;var k=false;var t=false;var g=function(C){var B=o+imageGroup2;if(B>=u.length){return}var z=document.getElementById("backimg");z.src=u[B].background?u[B].background:v;if(l>=0){m[l].removeHandler()}if(C!=undefined){l=C}m[0]=new Btrail(u[B].images,B,window.innerWidth,window.innerHeight,d,k);m[1]=new Bslide(u[B].images,B,window.innerWidth,window.innerHeight,d,k);m[2]=new Bzoom(u[B].images,B,window.innerWidth,window.innerHeight,d,k);m[3]=new BzoomOut(u[B].images,B,window.innerWidth,window.innerHeight,d,k);m[4]=new Bprocessing(q[B],B,window.innerWidth,window.innerHeight,d,k);var A=u[B].author;if(l==4){A=this.sketchLoader.sketches[B].author}m[l].addHandler();m[l].setCredits(A,h[2]);var y=m[l];y.textInfo.changeTextA(y.shuffle,y.micInput,r)};this.onCommand=function(B){switch(B){case"shuffle":var z=m[l];z.shuffle=d=!d;z.textInfo.changeTextA(z.shuffle,z.micInput,r);break;case"background":var z=m[l];r=!r;var A=document.getElementById("backimg");A.style.display=r?"block":"none";z.textInfo.changeTextA(z.shuffle,z.micInput,r);break;case"textinfo":w=!w;var y=document.getElementById("textInfo");y.style.display=w?"block":"none";break;case"sound":var z=m[l];z.soundPlaying=k=!k;f.play(k);if(!k){z.getSoundInfo(0)}break;case"mic":if(!p){var z=m[l];z.micInput=t=!t;f.activate("mic",t);z.textInfo.changeTextA(z.shuffle,z.micInput,r)}break}};this.onTouch=function(A){if(A.type=="swipe"&&A.count>=1){var y;if(A.dir=="left"||A.dir=="right"){y=l;if(A.dir=="left"){y++}else{if(A.dir=="right"){y--}}if(y<0||y>4){return}}else{var z=o+imageGroup2;if(A.dir=="up"){z++}else{if(A.dir=="down"){z--}}if(z<0||z>=u.length){return}o=z%10;imageGroup2=Math.floor(z/10)}g(y)}else{if(A.type=="tap"){console.log(A.code);this.onCommand(e[A.code])}else{m[l].touch(A)}}};this.onAudio=function(y){m[l].soundLevel=y};var c=function(A){var z=A.which;var B;if(48<=z&&z<=57){o=(z-48)*10;imageGroup2=0;g()}else{if(Object.keys(e).indexOf(z.toString())>=0){this.onCommand(e[z])}else{B=String.fromCharCode(z);if(Object.keys(a).indexOf(B)>=0){imageGroup2=a[B];g()}else{if(Object.keys(j).indexOf(B)>=0){var y=j[B];g(y)}}}}A.preventDefault();A.stopPropagation()};var b=function(){var F=new XMLHttpRequest();F.open("get","media.xml",false);F.overrideMimeType("text/xml");F.send(null);if(F.status!=200){return false}var C=F.responseXML;var z=C.firstChild;f.init(z.getAttribute("sound"));h[2]=z.getAttribute("soundauthor");h[3]=z.getAttribute("soundurl");v=z.getAttribute("bgimage");if(v){var B=document.getElementById("backimg");B.src=v;B.style.display="block";r=true}var y=C.evaluate("/media/group",C,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);var D=y.snapshotLength;var E=false;for(var A=0;A<y.snapshotLength;A++){u[A]=new Group(y.snapshotItem(A),function(I){if(--D<=0){var H=3;if(window.location.hash){H=parseInt(window.location.hash.substring(1))}if(E){g(H)}}})}var G=C.evaluate("/media/sketches",C,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);this.sketchLoader=new SketchLoader(G.singleNodeValue,function(H){q=H;E=true;if(D<=0){var I=3;if(window.location.hash){I=parseInt(window.location.hash.substring(1))}g(I)}});return true};var s=function(){p=navigator.userAgent.match(/iPad/i)!=null;x=new TouchUI();f=new AudioEngine();b();document.addEventListener("keydown",c.bind(n))};s();return this};var avvx;function avvxinit(){avvx=new AVVX()}var Behavior=function(d,a,g,b,f,e,c){this.images=a;this.textInfo=new TextInfo(d);this.group=g;this.stageW=b;this.stageH=f;this.shuffle=e;this.soundPlaying=c;this.micInput=false;this.running=false;this.soundLevel=0};Behavior.prototype={constructor:Behavior,init:function(){},exit:function(){},updateText:function(){},onUpdate:function(){},onInput:function(a,b){},onResize:function(){},addHandler:function(){this.init();this.textInfo.init(this.group,this.shuffle,false,this.title);this.updateText();this.cbKey=this.key.bind(this);this.cbResize=this.resize.bind(this);document.addEventListener("keydown",this.cbKey,false);window.addEventListener("resize",this.cbResize);var a=this;var b=function(){a.onUpdate();if(a.running){window.requestAnimationFrame(b)}};this.running=true;b()},removeHandler:function(){this.running=false;window.removeEventListener("resize",this.cbResize);document.removeEventListener("keydown",this.cbKey);this.exit()},setCredits:function(b,a){this.textInfo.setCredits(b,a)},updateLayers:function(){var a=document.getElementById("topLayer");document.body.removeChild(a);document.body.appendChild(a)},getSoundInfo:function(a){this.soundLevel=a},resize:function(a){this.stageW=window.innerWidth;this.stageH=window.innerHeight;this.onResize()},key:function(a){if(this.onInput("trigger",a.which)){this.updateText()}a.stopPropagation()},touch:function(a){var b=false;switch(a.type){case"tap":b=this.onInput("trigger",a.code);break;case"swipe":b=this.onInput("swipe",a.dir);break;case"slider":b=this.onInput("slider",a);break;case"transform":b=this.onInput("transform",a);break}if(b){this.updateText()}},importImage:function(a,c){var b=null;var d=a[0];if(d){b=document.importNode(d.documentElement,true);b.style.width=this.stageW;b.style.height=this.stageH;b.style.position="absolute";b.style.left=b.style.top=0}return b},getFirstElement:function(a){for(i=0;i<a.childNodes.length;i++){if(a.childNodes[i].nodeType==1){return a.childNodes[i]}}return null}};var Btrail=function(o,l,n,v,g,p){var s=1;var f=10;var x=0;var r=0;var e=1;var m=0;var y=1;var z=0;var u=20;var b=0;var k=posY=0;var j=speedY=1;var t=1;var a=[];var q;Behavior.call(this,"Trails",o,l,n,v,g,p);this.init=function(){q=document.createElement("div");q.style.width=this.stageW;q.style.height=this.stageH;q.style.position="absolute";q.style.left=q.style.top=0;document.body.appendChild(q);a=[];k=Math.random()*(this.stageW/2)+this.stageW/4;posY=Math.random()*(this.stageH/2)+this.stageH/4};this.exit=function(){document.body.removeChild(q)};this.onUpdate=function(){var D;if(m%y==0){if(a.length>u){q.removeChild(a[0]);a.splice(0,1)}if(this.shuffle){var C=Math.floor(Math.random()*this.images.length);D=this.images[C]}else{D=this.images[b++];if(b>=this.images.length){b=0}}var B=document.importNode(D.documentElement,true);B.style.width=this.stageW;B.style.height=this.stageH;B.style.position="absolute";B.style.left=0;B.style.top=0;var h="translate("+k+" "+posY+")";h+=" scale("+(s+this.soundLevel)+")";h+=" rotate("+r+")";var w=this.getFirstElement(B);w.setAttribute("transform",h);B.style.opacity=t;q.appendChild(B);this.updateLayers();a.push(B);if(++z>=u){z=0}var A=w.getBoundingClientRect();if(A.left<0-A.width/4){d()}else{if(A.right>this.stageW+A.width/4){d();j*=-1}}if(A.top<0-A.height/4){c()}else{if(A.bottom>this.stageH+A.height/4){c();speedY*=-1}}}k+=j*e;posY+=speedY*e;r+=x;m++};var d=function(){j=Math.random()*3.5+1.5};var c=function(){speedY=Math.random()*3.5+1.5};this.onInput=function(h,A){if(h=="trigger"){switch(A){case 38:x+=1;break;case 40:x-=1;break;case 39:if(f<10){f++}t=f*0.1;break;case 37:if(f>0){f--}t=f*0.1;break;case 88:s+=0.1;break;case 90:if(s>0.1){s-=0.1}break;case 86:e+=1;break;case 67:if(e>0){e-=1}break;case 78:y+=1;break;case 66:if(y>1){u-=1}break;default:return false}}else{if(h=="slider"){if(A.id=="s1"){var w=Math.round(30*(A.value-50)/50);if(w!=x){x=w}else{return false}}if(A.id=="s2"){var w=A.value;if(w!=t){t=w/100}else{return false}}if(A.id=="s3"){var w=10*(A.value);if(w!=s){s=w/100}else{return false}}if(A.id=="s4"){var w=Math.round(20*(A.value/100));if(w!=e){e=w}else{return false}}if(A.id=="s5"){var w=Math.round(20*(A.value/100));if(w!=y){y=w}else{return false}}}}return true};this.updateText=function(){var w=s.toFixed(1);var h=t.toFixed(1);this.textInfo.changeTextB(["rotation: "+x,"alpha: "+h,"size: "+w,"spacing: "+e,"speed: "+y])}};Btrail.prototype=Object.create(Behavior.prototype);var Bslide=function(t,q,s,B,m,u){var y=1;var K="down";var c=10;var F=13;var l=2;var v=[];var L=20;var C=250;var r=0;var p=posY=0;var J=1;var I=0;var A=20;var b=0;var n=speedY=1;var z=1;var a=[];var G,E;var k=[];var H=[];var j=[];var g=[];var f=[];var e=[];var x=this;Behavior.call(this,"Slide",t,q,s,B,m,u);this.init=function(){G=document.createElement("div");E=document.createElement("div");document.body.appendChild(G);document.body.appendChild(E);G.style.width=E.style.width=this.stageW;G.style.height=E.style.height=this.stageH;G.style.position=E.style.position="absolute";G.style.left=E.style.left=0;G.style.top=E.style.top=0;v.down=1;v.up=2;v.left=3;v.right=4;for(var h=0;h<L;h++){H.push(Math.random()*0.75+0.25);j.push(Math.random()+1);g.push(j[h]);f.push(Math.random());e.push(f[h]);k.push(1)}d(G,j,f,this.stageW,this.stageH);d(E,g,e,this.stageW,this.stageH)};this.exit=function(){document.body.removeChild(G);document.body.removeChild(E)};this.onUpdate=function(){if(G.children.length==L){o(G,j,f)}if(E.children.length==L){o(E,g,e)}r++;if(C%2!=0){C--}if(r==C/2){d(G,j,f,this.stageW,this.stageH)}if(r==C){d(E,g,e,this.stageW,this.stageH);r=0}};var o=function(Q,h,w){var M=x.soundLevel;for(var N=0;N<L;N++){var S=dy=0;var P=h[N]*F;switch(y){case 1:dy+=P;break;case 2:dy-=P;break;case 3:S-=P;break;case 4:S+=P;break}Q.children[N].x+=S;Q.children[N].y+=dy;Q.children[N].rotation+=w[N]*c;var O=x.getFirstElement(Q.children[N]);O=x.getFirstElement(O);var R=O.transform.baseVal.getItem(0);R.setTranslate(Q.children[N].x,Q.children[N].y);R=O.transform.baseVal.getItem(1);R.setRotate(Q.children[N].rotation%360,0,0);R=O.transform.baseVal.getItem(2);R.setScale(H[N]*l+M*2,H[N]*l+M*2)}};var d=function(N,Q,R,X,W){for(var S=0;S<L;S++){var Y;if(x.shuffle){var O=Math.floor(Math.random()*x.images.length);Y=x.images[O]}else{Y=x.images[b++];if(b>=x.images.length){b=0}}var V=document.importNode(Y.documentElement,true);V.style.width=X;V.style.height=W;var M=parseInt(V.getAttribute("width"));var P=parseInt(V.getAttribute("height"));switch(y){case 1:p=Math.random()*window.innerWidth-(window.innerWidth-M)/2;posY=-(window.innerHeight+Math.random()*window.innerHeight);K="down";break;case 2:p=Math.random()*window.innerWidth-(window.innerWidth-M)/2;posY=window.innerHeight+Math.random()*window.innerHeight;K="up";break;case 3:p=window.innerWidth+Math.random()*window.innerWidth;posY=Math.random()*window.innerHeight-(window.innerHeight-P)/2;K="left";break;case 4:p=-(window.innerWidth+Math.random()*window.innerWidth);posY=Math.random()*window.innerHeight-(window.innerHeight-P)/2;K="right";break}var U=x.getFirstElement(V);U.setAttribute("transform","translate("+p+","+posY+") rotate(0) scale(0)");var T=document.createElement("div");T.style.position="absolute";T.style.left=T.style.top=0;T.x=T.y=T.rotation=0;T.appendChild(V);if(N.children.length==L){N.removeChild(N.children[0])}N.appendChild(T);x.updateLayers();T.x=p;T.y=posY;T.style.opacity=k[S]}};this.onResize=function(){D(G,this.stageW,this.stageH);D(E,this.stageW,this.stageH)};var D=function(O,M,P){O.style.width=M;O.style.height=P;for(var N=0;N<O.children.length;N++){var Q=O.children[N];Q.children[0].style.width=M;Q.children[0].style.height=P}};this.onInput=function(h,M){if(h=="trigger"){switch(M){case 38:if(y<4){y++}else{y=1}break;case 40:if(y>1){y--}else{y=4}break;case 39:c++;break;case 37:if(c>0){c--}break;case 88:F++;break;case 90:if(F>10){F--}break;case 86:l++;break;case 67:if(l>0){l--}break;default:return false}}else{if(h=="slider"){if(M.id=="s1"){var w=Math.round(3*(M.value/100))+1;if(w!=y){y=w}else{return false}}if(M.id=="s2"){var w=Math.round(30*(M.value/100));if(w!=c){c=w}else{return false}}if(M.id=="s3"){var w=Math.round(50*(M.value/100))+10;if(w!=F){F=w}else{return false}}if(M.id=="s4"){var w=Math.round(5*(M.value))+100;if(w!=l){l=w/100}else{return false}}}}return true};this.updateText=function(){switch(y){case 1:K="down";break;case 2:K="up";break;case 3:K="left";break;case 4:K="right";break}this.textInfo.changeTextB(["direction: "+K,"rotation: "+c,"speed: "+F,"size: "+l])}};Bslide.prototype=Object.create(Behavior.prototype);var Bzoom=function(l,e,k,s,d,m){var g=k/2;var f=s/2;var u=0;var p=60;var v=4;var x=[];var t=[];var n=[];var j=0;var c=0;var a=0;var q=100;var o=this;Behavior.call(this,"Zoom",l,e,k,s,d,m);this.init=function(){for(var h=0;h<v;h++){x[h]=document.createElement("div");x[h].style.width=this.stageW;x[h].style.height=this.stageH;x[h].style.position="absolute";x[h].style.left=x[h].style.top=0;document.body.appendChild(x[h])}r()};this.exit=function(){for(var h=0;h<x.length;h++){document.body.removeChild(x[h])}};var b=function(C){var A=x[C].svgwidth;var D=x[C].svgheight;var F=window.innerWidth/2-(window.innerWidth-A)/2;var z=F+(Math.random()*2-1)*q;var E=window.innerHeight/2-(window.innerHeight-D)/2;var G=E+(Math.random()*2-1)*q;var B=x[C].children[0];o.getFirstElement(B).setAttribute("transform","translate("+z+","+G+") rotate(0) scale(0)");x[C].scaleX=100;x[C].scaleY=100;x[C].rotation=0;x[C].children[0].style.opacity=Math.random()*0.6+0.2;t[C]=Math.round(Math.random());n[C]=0};this.onUpdate=function(){for(var z=0;z<v;z++){x[z].scaleX=n[z];x[z].scaleY=n[z];var A=0.05;x[z].scaleX+=A;x[z].scaleY+=A;n[z]=x[z].scaleX;x[z].scaleX*=1+this.soundLevel;x[z].scaleY*=1+this.soundLevel;if(u){if(t[z]){x[z].rotation+=u}else{x[z].rotation-=u}}if(x[z].children.length>0){var h=x[z].rotation%360;if(h<0){h+=360}var w=this.getFirstElement(x[z].children[0]);var y=w.transform.baseVal.getItem(1);y.setRotate(h,0,0);y=w.transform.baseVal.getItem(2);y.setScale(x[z].scaleX,x[z].scaleY)}}j++;if(j>=p){j=0;r()}};var r=function(){var y;if(o.shuffle){var w=Math.floor(Math.random()*o.images.length);y=o.images[w]}else{y=o.images[a++];if(a>=o.images.length){a=0}}var h=document.importNode(y.documentElement,true);h.style.width=o.stageW;h.style.height=o.stageH;x[c].svgwidth=parseInt(h.getAttribute("width"));x[c].svgheight=parseInt(h.getAttribute("height"));if(x[c].children.length>0){x[c].removeChild(x[c].children[0])}x[c].appendChild(h);o.updateLayers();b(c);c++;if(c==v){c=0}};this.onResize=function(){for(var h=0;h<v;h++){x[h].style.width=this.stageW;x[h].style.height=this.stageH}};this.onInput=function(h,y){if(h=="trigger"){switch(y){case 38:u+=1;break;case 40:u-=1;break;case 37:if(p>6){p-=6}break;case 39:if(p<150){p+=6}break;case 90:if(q>1){q-=10}break;case 88:if(q<500){q+=10}break;default:return false}}else{if(h=="slider"){if(y.id=="s1"){var w=Math.round(15*(y.value-50)/50);if(w!=u){u=w}else{return false}}else{if(y.id=="s2"){var w=6+Math.round((150-6)*y.value/100);if(w!=p){p=w}else{return false}}else{if(y.id=="s3"){var w=Math.round(500*(y.value/100));if(w!=q){q=w}else{return false}}}}}}return true};this.updateText=function(){var h=(p/60).toFixed(1);this.textInfo.changeTextB(["rotation: "+u,"timer: "+h+"s","decenter: "+q])}};Bzoom.prototype=Object.create(Behavior.prototype);var BzoomOut=function(l,e,k,s,d,m){var g=k/2;var f=s/2;var u=0;var p=40;var v=4;var x=[];var t=[];var n=[];var j=0;var c=0;var a=0;var q=100;var o=this;Behavior.call(this,"ZoomOut",l,e,k,s,d,m);this.init=function(){for(var h=0;h<v;h++){x[h]=document.createElement("div");x[h].style.width=this.stageW;x[h].style.height=this.stageH;x[h].style.position="absolute";x[h].style.left=x[h].style.top=0;document.body.appendChild(x[h])}r()};this.exit=function(){for(var h=0;h<x.length;h++){document.body.removeChild(x[h])}};var b=function(C){var A=x[C].svgwidth;var D=x[C].svgheight;var F=window.innerWidth/2-(window.innerWidth-A)/2;var z=F+(Math.random()*2-1)*q;var E=window.innerHeight/2-(window.innerHeight-D)/2;var G=E+(Math.random()*2-1)*q;var B=x[C].children[0];o.getFirstElement(B).setAttribute("transform","translate("+z+","+G+") rotate(0) scale(0)");x[C].scaleX=100;x[C].scaleY=100;x[C].rotation=0;x[C].children[0].style.opacity=Math.random()*0.6+0.2;t[C]=Math.round(Math.random());n[C]=5};this.onUpdate=function(){for(var z=0;z<v;z++){x[z].scaleX=n[z];x[z].scaleY=n[z];var A=0.05;if(x[z].scaleX>A){x[z].scaleX-=A;x[z].scaleY-=A}n[z]=x[z].scaleX;x[z].scaleX*=1+this.soundLevel;x[z].scaleY*=1+this.soundLevel;if(u){if(t[z]){x[z].rotation+=u}else{x[z].rotation-=u}}if(x[z].children.length>0){var h=x[z].rotation%360;if(h<0){h+=360}var w=this.getFirstElement(x[z].children[0]);var y=w.transform.baseVal.getItem(1);y.setRotate(h,0,0);y=w.transform.baseVal.getItem(2);y.setScale(x[z].scaleX,x[z].scaleY)}}j++;if(j>=p){j=0;r()}};var r=function(){var y;if(o.shuffle){var w=Math.floor(Math.random()*o.images.length);y=o.images[w]}else{y=o.images[a++];if(a>=o.images.length){a=0}}var h=document.importNode(y.documentElement,true);h.style.width=o.stageW;h.style.height=o.stageH;x[c].svgwidth=parseInt(h.getAttribute("width"));x[c].svgheight=parseInt(h.getAttribute("height"));if(x[c].children.length>0){x[c].removeChild(x[c].children[0])}x[c].appendChild(h);o.updateLayers();b(c);c++;if(c==v){c=0}};this.onResize=function(){for(var h=0;h<v;h++){x[h].style.width=this.stageW;x[h].style.height=this.stageH}};this.onInput=function(h,y){if(h=="trigger"){switch(y){case 38:u+=1;break;case 40:u-=1;break;case 37:if(p>6){p-=6}break;case 39:if(p<150){p+=6}break;case 90:if(q>0){q-=10}break;case 88:if(q<500){q+=10}break;default:return false}}else{if(h=="slider"){if(y.id=="s1"){var w=Math.round(15*(y.value-50)/50);if(w!=u){u=w}else{return false}}else{if(y.id=="s2"){var w=6+Math.round((150-6)*y.value/100);if(w!=p){p=w}else{return false}}else{if(y.id=="s3"){var w=Math.round(500*(y.value/100));if(w!=q){q=w}else{return false}}}}}}return true};this.updateText=function(){var h=(p/60).toFixed(1);this.textInfo.changeTextB(["rotation: "+u,"timer: "+h+"s","decenter: "+q])}};BzoomOut.prototype=Object.create(Behavior.prototype);var Bprocessing=function(f,e,a,d,c,b){Behavior.call(this,"Processing",f,e,a,d,c,b);this.init=function(){var g=document.createElement("canvas");g.style.outline="none";g.style.position="absolute";g.style.left=g.style.top=0;g.width=a;g.height=d;g.tabIndex=1;document.body.appendChild(g);this.canvas=g;this.p=new Processing(g,f);this.textInfoB=new this.p.ArrayList();this.textInfoC=new this.p.ArrayList();if(this.p.avvx_init){this.title=this.p.avvx_init()}if(this.p.avvx_resize){this.p.avvx_resize(window.innerWidth,window.innerHeight)}this.canvas.focus()};this.exit=function(){this.p.exit();if(this.p.avvx_exit){this.p.avvx_exit()}document.body.removeChild(this.canvas)};this.onResize=function(){if(this.p.avvx_resize){this.p.avvx_resize(window.innerWidth,window.innerHeight)}};this.addHandler=function(){Behavior.prototype.addHandler.call(this);this.running=false};this.onInput=function(g,h){if(this.p.avvx_interaction){return this.p.avvx_interaction(g,h)}};this.updateText=function(){if(this.p.avvx_updateText){this.textInfoB.clear();this.textInfoC.clear();this.p.avvx_updateText(this.textInfoB,this.textInfoC);this.textInfo.changeTextB(this.textInfoB.toArray());this.textInfo.changeTextC(this.textInfoC.toArray())}}};Bprocessing.prototype=Object.create(Behavior.prototype);